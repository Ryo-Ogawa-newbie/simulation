<!DOCTYPE html>
<html>
<head>
  <title>Equation Solver</title>
</head>
<body>
  <h2>方程式: ax^2 + bx + c = 0</h2>
  <p>a: <input type="number" id="inputA">, b: <input type="number" id="inputB">, c: <input type="number" id="inputC"></p>
  <button onclick="updateEquation()">更新</button>
  
  <br><br>
  
  <button onclick="showInputFields('bisection')">二分法</button>
  <button onclick="showInputFields('newton')">ニュートン法</button>
  
  <div id="methodInputs"></div>
  
  <br><br>
  
  <p>試行回数: <input type="number" id="iterationCount"></p>
  <button onclick="startCalculation()">試行開始</button>
  <button onclick="resetAll()">リセット</button>
  
  <div id="results"></div>
  
  <script>
    var equation = {
      a: null,
      b: null,
      c: null
    };
    
    var methodInputs = {
      bisection: {
        lower: null,
        upper: null
      },
      newton: {
        initialGuess: null
      }
    };
    
    function updateEquation() {
      equation.a = parseFloat(document.getElementById("inputA").value);
      equation.b = parseFloat(document.getElementById("inputB").value);
      equation.c = parseFloat(document.getElementById("inputC").value);
    }
    
    function showInputFields(method) {
      var methodInputsContainer = document.getElementById("methodInputs");
      methodInputsContainer.innerHTML = "";
      
      var methodHeader = document.createElement("h3");
      var inputLabel = document.createElement("label");
      var input = document.createElement("input");
      
      if (method === 'bisection') {
        methodHeader.textContent = "解の範囲";
        inputLabel.textContent = "数字を自由入力 [a, b]";
        input.placeholder = "a";
        input.id = "inputLower";
        methodInputs.bisection.lower = null;
        methodInputs.bisection.upper = null;
      } else if (method === 'newton') {
        methodHeader.textContent = "初期推定値";
        inputLabel.textContent = "数字を自由入力";
        input.placeholder = "初期推定値";
        input.id = "inputInitial";
        methodInputs.newton.initialGuess = null;
      }
      
      methodInputsContainer.appendChild(methodHeader);
      methodInputsContainer.appendChild(inputLabel);
      methodInputsContainer.appendChild(input);
    }
    
    function startCalculation() {
      var iterationCount = parseInt(document.getElementById("iterationCount").value);
      var resultsContainer = document.getElementById("results");
      resultsContainer.innerHTML = "";
      
      if (methodInputs.bisection.lower !== null && methodInputs.bisection.upper !== null) {
        var bisectionResults = document.createElement("p");
        var bisectionResultText = `二分法の計算結果: [${calculateBisection(equation.a, equation.b, equation.c, methodInputs.bisection.lower, methodInputs.bisection.upper, iterationCount).join(", ")}]`;
        bisectionResults.textContent = bisectionResultText;
        resultsContainer.appendChild(bisectionResults);
      }
      
      if (methodInputs.newton.initialGuess !== null) {
        var newtonResults = document.createElement("p");
        var newtonResultText = `ニュートン法の計算結果: ${calculateNewton(equation.a, equation.b, equation.c, methodInputs.newton.initialGuess, iterationCount)}`;
        newtonResults.textContent = newtonResultText;
        resultsContainer.appendChild(newtonResults);
      }
    }
    
   function calculateBisection(a, b, c, lower, upper, iterationCount) {
    var results = [];
    for (var i = 0; i < iterationCount; i++) {
      var midpoint = (lower + upper) / 2;
      var fMid = calculateEquation(a, b, c, midpoint);
      
      if (fMid === 0 || (upper - lower) / 2 < 0.00001) {
        results.push(lower);
        results.push(upper);
        break;
      }
      
      if (fMid * calculateEquation(a, b, c, lower) < 0) {
        upper = midpoint;
      } else {
        lower = midpoint;
      }
    }
    return results;
  }
    
    function calculateNewton(a, b, c, initialGuess, iterationCount) {
    var result = initialGuess;
    for (var i = 0; i < iterationCount; i++) {
      var f = calculateEquation(a, b, c, result);
      var fPrime = calculateDerivative(a, b, result);
      result = result - f / fPrime;
    }
    return result;
  }
  
  // 方程式の計算
  function calculateEquation(a, b, c, x) {
    return a * x * x + b * x + c;
  }
  
  // 方程式の導関数の計算
  function calculateDerivative(a, b, x) {
    return 2 * a * x + b;
  }
    
    function resetAll() {
      var methodInputsContainer = document.getElementById("methodInputs");
      var resultsContainer = document.getElementById("results");
      
      methodInputsContainer.innerHTML = "";
      resultsContainer.innerHTML = "";
      equation = {
        a: null,
        b: null,
        c: null
      };
      
      methodInputs = {
        bisection: {
          lower: null,
          upper: null
        },
        newton: {
          initialGuess: null
        }
      };
      
      document.getElementById("inputA").value = "";
      document.getElementById("inputB").value = "";
      document.getElementById("inputC").value = "";
      document.getElementById("iterationCount").value = "";
      document.getElementById("inputLower").value = "";
      document.getElementById("inputInitial").value = "";
    }
  </script>
</body>
</html>

